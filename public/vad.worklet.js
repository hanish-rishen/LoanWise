(()=>{"use strict";let e;!function(e){e.AudioFrame="AUDIO_FRAME",e.SpeechStart="SPEECH_START",e.VADMisfire="VAD_MISFIRE",e.SpeechEnd="SPEECH_END"}(e||(e={}));const t="[VAD]",i=["error","debug","warn"].reduce(((e,i)=>(e[i]=function(e){return function(){for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];console[e](t,...r)}}(i),e)),{});class r{constructor(e){var t,r;r=e=>{const t=[];for(const t of e)this.inputBuffer.push(t);for(;this.inputBuffer.length*this.options.targetSampleRate/this.options.nativeSampleRate>this.options.targetFrameSize;){const e=new Float32Array(this.options.targetFrameSize);let i=0,r=0;for(;i<this.options.targetFrameSize;){let t=0,s=0;for(;r<Math.min(this.inputBuffer.length,(i+1)*this.options.nativeSampleRate/this.options.targetSampleRate);)t+=this.inputBuffer[r],s++,r++;e[i]=t/s,i++}this.inputBuffer=this.inputBuffer.slice(r),t.push(e)}return t},(t="process")in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[t]=r,this.options=e,e.nativeSampleRate<16e3&&i.error("nativeSampleRate is too low. Should have 16000 = targetSampleRate <= nativeSampleRate"),this.inputBuffer=[]}}function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class a extends AudioWorkletProcessor{constructor(e){super(),s(this,"_initialized",!1),s(this,"init",(async()=>{i.debug("initializing worklet"),this.resampler=new r({nativeSampleRate:sampleRate,targetSampleRate:16e3,targetFrameSize:this.options.frameSamples}),this._initialized=!0,i.debug("initialized worklet")})),this.options=e.processorOptions,this.init()}process(t,i,r){const s=t[0][0];if(this._initialized&&s instanceof Float32Array){const t=this.resampler.process(s);for(const i of t)this.port.postMessage({message:e.AudioFrame,data:i.buffer},[i.buffer])}return!0}}registerProcessor("vad-helper-worklet",a)})();